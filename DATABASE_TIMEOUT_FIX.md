# 数据库初始化超时修复指南

## 问题描述
控制台日志显示：`数据库初始化过程出错: Error: 数据库初始化超时 at ProjectContext.jsx:37:1`

## 根本原因分析

1. **健康检查函数问题**：原`healthCheck()`函数尝试调用不存在的`supabase.rpc('ping')`函数
2. **超时时间过短**：原8秒超时时间在网络较慢时不够用
3. **初始化逻辑复杂**：多步骤初始化过程容易累积延迟

## 修复方案

### 1. 优化健康检查函数 (`apiClient.js`)
- 移除不存在的RPC调用
- 使用简单的表查询进行连接测试
- 添加响应时间监控
- 检测表是否存在（需要初始化的情况）

### 2. 改进初始化逻辑 (`ProjectContext.jsx`)
- 增加超时时间到15秒
- 优化错误处理和日志记录
- 根据健康检查结果决定是否需要初始化

### 3. 增强错误处理
- 即使数据库初始化失败，也允许用户继续使用应用
- 提供离线模式支持
- 详细的错误日志帮助诊断问题

## 修复后的行为

1. **快速健康检查**：使用简单的`users`表查询测试连接
2. **智能初始化**：只在检测到需要时才执行初始化
3. **超时保护**：15秒超时防止无限等待
4. **优雅降级**：初始化失败时仍可继续使用应用

## 验证修复效果

修复后，您应该看到以下控制台日志：

```
数据库已初始化，响应时间: XXXms
```

或者（如果需要初始化）：

```
检测到数据库需要初始化...
数据库初始化完成
```

如果仍然超时：

```
数据库初始化超时（15秒），继续应用加载...
```

## 进一步优化建议

1. **网络优化**：确保Supabase服务网络连接稳定
2. **数据库优化**：在Supabase控制台优化数据库性能
3. **监控设置**：添加数据库性能监控
4. **缓存策略**：实施适当的缓存机制减少数据库查询

## 故障排除

如果仍然遇到超时问题：

1. 检查网络连接速度
2. 验证Supabase服务状态
3. 查看完整的控制台错误日志
4. 考虑增加超时时间或实施分步初始化